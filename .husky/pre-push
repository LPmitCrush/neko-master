#!/usr/bin/env sh

# Only run checks when pushing to main branch
while read local_ref local_oid remote_ref remote_oid; do
  if echo "$remote_ref" | grep -q "refs/heads/main$"; then
    echo "ğŸ” Pushing to main â€” running pre-push checks..."

    echo "â†’ Running collector type check..."
    pnpm --filter collector exec tsc --noEmit || exit 1

    echo "â†’ Building web app..."
    pnpm --filter @neko-master/web build || exit 1

    echo "âœ… All checks passed."
    exit 0
  fi
done

# Not pushing to main, allow push
exit 0
